
select
    rm.account_id,
    rm.meter_point_id,
    rm.meterpointnumber as mprn,
    rm.associationstartdate as asd,
    rm.associationenddate as aed,
    rm.supplystartdate as ssd,
    rm.supplyenddate as sed,
    rriv.readingvalue as read_val,
    rriv.meterreadingdatetime as read_date,
    rriv.meterreadingsourceuid as read_type,
    case when read_val isnull then 1 else 0 end as missing_closing_read
from ref_meterpoints rm
left join ref_readings_internal_valid rriv
    on rriv.meterpointnumber = rm.meterpointnumber
        and abs(datediff(days,rm.supplyenddate,rriv.meterreadingdatetime))<=5
where rm.account_id in (27339,27374,37647,45964,46102,5828,14401,15419,19671,42451,43838,46244,46284,47535,8215,14440,22858,29101,30115,35252,42563,26229,16528,24702,41685,43878,46325,46491,2623,10988,16689,17425,29457,45773,25338,42354,43658,12841,25023,29192,43000,45610,45916,46285,1923,5388,7711,12544,18945,20393,7594,21786,24251,38938,41618,7341,11877,13514,14227,19286,23254,23524,31295,31906,36249,38935,8465,8479,24846,35396,40803,45107,45703,45760,7865,4361,23533,45424,46212,46521,12444,46098,16712,34978,11687,13307,45587,23728,18076,21398,30010,30252,37535,45488,46277,20067,26479,27813,41869,36151,45793,1941,41489,42074,42876,43117,25824,38206,11517,12253,18714,30382,43134,22807,35897,41838,42891,6632,13600,19786,36192,39152,41980,7956,14843,41739,42795,43126,43131,43833,31844,14829,15019,39028,42539,42708,43869,45820,15386,17362,24694,39105,41070,31871,4746,6871,40802,43715,7957,23139,25221,16140,22810,32688,7381,12564,21663,21918,3678,35841,7723,20847,34870,41102,34312,2536,14620,7379,12976,43867,45087,16872,25684,43112,5113,8156,36785,37896,14940,25201,33034,42423,8067,22913,37587,41063,17562,7683,29589,41846,29358,36871,36754,40538,16708,42402,26645,4881,42344,6849,26574,43048,43966,42644,42647,32891,37150,34546,41831,34250,13134,12204,33434,5590,7837,33716,42208,2716,6012,21516,17760,41828,1976,3986,13822,40801,33115,33136,3174,38395,22621,35421,2839,13623,25006,20538,15374,14623,21725,22837,38672,38673,22059,29400,38401,40412,4890,5668,29034,5988,20364,17007,37075,41035,10902,17563,2889,22415,33653,24914,38667,38671,16490,3274,11397,24370,34442,22893,36925,22341,33007,23913,22197,38191,18482,38637,29569,21318,38377,5119,2111,16784,33504,34890,29697,7708,27136,17764,27908,16052,15872,32994,26510,30442,34182,33810,2226,19717,14791,6204,36988,30272,34451,25468,31395,28547,17381,11802,22581,27916,21955,17624,6017,11473,5485,21487,28574,13105,2314,6923,25698,13062,23482,17189,25230,18966,22172,2501,18892,23464,19012,19675,9702,18472,6556,12274)
    and supplyenddate > supplystartdate
    and missing_closing_read=1
order by account_id asc

