/*Erroneous Transfer*/

select * from ref_meterpoints mp
left outer join ref_meterpoints_attributes mpa on mp.account_id = mpa.account_id and mp.meter_point_id = mpa.meter_point_id
where mp.account_id = 29287;

select x.account_id, x.meter_point_id, x.meterpointnumber, max(x.attributes_attributename), max(x.associationenddate) ass_end_date, count(*) from (
  select mp.*, mpa1.attributes_attributename
from ref_meterpoints mp
left outer join (select mpa.account_id, mpa.meter_point_id, mpa.attributes_attributename from ref_meterpoints_attributes mpa
                  where mpa.attributes_attributename = 'ET'
                  group by mpa.account_id, mpa.meter_point_id, mpa.attributes_attributename) mpa1 on mpa1.account_id = mp.account_id and mpa1.meter_point_id = mp.meter_point_id
  ) x
where account_id in
(
3289,
5560,
5874,
8028,
13397,
13763,
14675,
16503,
19413,
19485,
19961,
20827,
21756,
21862,
24087,
27511,
27559,
27677,
27760,
27878,
28028,
28081,
28291,
28325,
29223,
29287,
29548,
29793,
30340,
30598,
31110,
34246,
36447,
41612
)
group by x.account_id, x.meter_point_id, x.meterpointnumber
-- having count(*) > 1

;

select * from ref_meterpoints where account_id in (
20827
    );
-- group by account_id;

select * from ref_meterpoints_attributes where account_id = 20827;

select * from ref_meters where account_id = 20827;
select * from ref_registers where account_id = 20827;

select * from ref_meterpoints mp
left outer join ref_meterpoints_attributes mpa on mp.account_id = mpa.account_id and mp.meter_point_id = mpa.meter_point_id
where attributes_attributename = 'ET' and mp.account_id in
                                          (
15402,
11893,
26955,
17073,
29064,
26371,
20502,
27449,
31829,
32205,
26732,
31935,
33080,
33010,
31386,
34074,
33808,
33694,
33065,
30525,
33905,
33029,
34158,
30462,
34311,
33752,
34305,
33544,
34766,
33801,
35034,
33028,
34017,
33876,
33873,
33853,
33838,
33811,
33765,
33756,
33750,
33272,
32992,
32992,
32747,
31499,
31496,
31466,
31329,
30718,
30430,
29591,
33387,
31396,
30842,
29008,
33955,
33881,
31824,
34068,
33833,
33744,
32761,
32757,
35679,
34069,
34003,
33270,
34229,
34294,
31837,
36261,
31807,
34588,
33968,
34205,
32801,
33962,
33969,
33110,
36968,
26017,
34072,
33515,
32279,
33883,
33778,
32623,
31997,
29928,
37161,
31289,
36887,
36522,
33226,
37786,
36466,
35971,
33585,
34165,
37927,
35201,
34062,
35227,
39139,
35037,
33589,
39059,
40558,
39178,
32069,
40687,
33034,
37896,
24659,
41407,
38407,
34115,
41412,
34652,
41351,
41188,
37052,
41965,
38693,
39125,
38966,
27048,
42379,
40345,
30561,
39149,
38206,
41617,
42714,
41799,
20539
);


select * from ref_meterpoints mp
left outer join ref_meterpoints_attributes mpa on mp.account_id = mpa.account_id and mp.meter_point_id = mpa.meter_point_id and attributes_attributename = 'ET'
where
--     attributes_attributename = 'ET' and
      mp.account_id in
(
3289,
5560,
5874,
8028,
13397,
13763,
14675,
16503,
19413,
19485,
19961,
20827,
21756,
21862,
24087,
27511,
27559,
27677,
27760,
27878,
28028,
28081,
28291,
28325,
29223,
29287,
29548,
29793,
30340,
30598,
31110,
34246,
36447,
41612
);