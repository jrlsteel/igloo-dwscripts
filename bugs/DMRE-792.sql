-- augmenting table with values copied from 364 days (52 weeks) prior
create table temp_d18_ppc_augmented as
select type,
       zpd,
       st_date,
       st_code,
       rt_code,
       run_no,
       gsp_group,
       gsp,
       gsp_group_id,
       noon_temp_act,
       noon_temp_eff,
       time_sunset,
       sunset_variable,
       pcl,
       pcl_id,
       pfl,
       pfl_id,
       ssc,
       ss_conf_id,
       vmr,
       time_pattern_regime,
       ppc,
       ppc_1,
       prsi_1,
       ppc_2,
       prsi_2,
       ppc_3,
       prsi_3,
       ppc_4,
       prsi_4,
       ppc_5,
       prsi_5,
       ppc_6,
       prsi_6,
       ppc_7,
       prsi_7,
       ppc_8,
       prsi_8,
       ppc_9,
       prsi_9,
       ppc_10,
       prsi_10,
       ppc_11,
       prsi_11,
       ppc_12,
       prsi_12,
       ppc_13,
       prsi_13,
       ppc_14,
       prsi_14,
       ppc_15,
       prsi_15,
       ppc_16,
       prsi_16,
       ppc_17,
       prsi_17,
       ppc_18,
       prsi_18,
       ppc_19,
       prsi_19,
       ppc_20,
       prsi_20,
       ppc_21,
       prsi_21,
       ppc_22,
       prsi_22,
       ppc_23,
       prsi_23,
       ppc_24,
       prsi_24,
       ppc_25,
       prsi_25,
       ppc_26,
       prsi_26,
       ppc_27,
       prsi_27,
       ppc_28,
       prsi_28,
       ppc_29,
       prsi_29,
       ppc_30,
       prsi_30,
       ppc_31,
       prsi_31,
       ppc_32,
       prsi_32,
       ppc_33,
       prsi_33,
       ppc_34,
       prsi_34,
       ppc_35,
       prsi_35,
       ppc_36,
       prsi_36,
       ppc_37,
       prsi_37,
       ppc_38,
       prsi_38,
       ppc_39,
       prsi_39,
       ppc_40,
       prsi_40,
       ppc_41,
       prsi_41,
       ppc_42,
       prsi_42,
       ppc_43,
       prsi_43,
       ppc_44,
       prsi_44,
       ppc_45,
       prsi_45,
       ppc_46,
       prsi_46,
       ppc_47,
       prsi_47,
       ppc_48,
       prsi_48,
       ppc_49,
       prsi_49,
       ppc_50,
       prsi_50
from (select min(type_id)
             over (partition by st_date, gsp_group_id, pcl_id, pfl_id, ss_conf_id, time_pattern_regime) as min_type_id,
             *
      from (select 1        as type_id,
                   'actual' as type,
                   *
            from ref_d18_ppc
            union
            select 2                                                                     as type_id,
                   'forecast'                                                            as type,
                   zpd,
                   to_char(dateadd(weeks, 52, to_date(st_date, 'YYYYMMDD')), 'YYYYMMDD') as st_date,
                   st_code,
                   rt_code,
                   '0000' as run_no,
                   gsp_group,
                   gsp,
                   gsp_group_id,
                   noon_temp_act,
                   noon_temp_eff,
                   time_sunset,
                   sunset_variable,
                   pcl,
                   pcl_id,
                   pfl,
                   pfl_id,
                   ssc,
                   ss_conf_id,
                   vmr,
                   time_pattern_regime,
                   ppc,
                   ppc_1,
                   prsi_1,
                   ppc_2,
                   prsi_2,
                   ppc_3,
                   prsi_3,
                   ppc_4,
                   prsi_4,
                   ppc_5,
                   prsi_5,
                   ppc_6,
                   prsi_6,
                   ppc_7,
                   prsi_7,
                   ppc_8,
                   prsi_8,
                   ppc_9,
                   prsi_9,
                   ppc_10,
                   prsi_10,
                   ppc_11,
                   prsi_11,
                   ppc_12,
                   prsi_12,
                   ppc_13,
                   prsi_13,
                   ppc_14,
                   prsi_14,
                   ppc_15,
                   prsi_15,
                   ppc_16,
                   prsi_16,
                   ppc_17,
                   prsi_17,
                   ppc_18,
                   prsi_18,
                   ppc_19,
                   prsi_19,
                   ppc_20,
                   prsi_20,
                   ppc_21,
                   prsi_21,
                   ppc_22,
                   prsi_22,
                   ppc_23,
                   prsi_23,
                   ppc_24,
                   prsi_24,
                   ppc_25,
                   prsi_25,
                   ppc_26,
                   prsi_26,
                   ppc_27,
                   prsi_27,
                   ppc_28,
                   prsi_28,
                   ppc_29,
                   prsi_29,
                   ppc_30,
                   prsi_30,
                   ppc_31,
                   prsi_31,
                   ppc_32,
                   prsi_32,
                   ppc_33,
                   prsi_33,
                   ppc_34,
                   prsi_34,
                   ppc_35,
                   prsi_35,
                   ppc_36,
                   prsi_36,
                   ppc_37,
                   prsi_37,
                   ppc_38,
                   prsi_38,
                   ppc_39,
                   prsi_39,
                   ppc_40,
                   prsi_40,
                   ppc_41,
                   prsi_41,
                   ppc_42,
                   prsi_42,
                   ppc_43,
                   prsi_43,
                   ppc_44,
                   prsi_44,
                   ppc_45,
                   prsi_45,
                   ppc_46,
                   prsi_46,
                   ppc_47,
                   prsi_47,
                   ppc_48,
                   prsi_48,
                   ppc_49,
                   prsi_49,
                   ppc_50,
                   prsi_50
            from ref_d18_ppc) augm
     ) tagged
where type_id = min_type_id;

-- testing
select distinct type from temp_d18_augmented
select type, count(*) from temp_d18_augmented group by type
select * from temp_d18_augmented where type = 'forecast' order by st_date